!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():this.$as=a()}(function(){function a(b){var c=a.cache[b];if(!c){var d={};c=a.cache[b]={id:b,exports:d},a.modules[b].call(d,c,d)}return c.exports}return a.cache=[],a.modules=[function(b,c){"use strict";var d=a(1),e=a(6),f=a(5);c=b.exports=function(a,c){return new b.exports.AsyncStepProtector(a,c)};var g=function(a){this._root=a,this.state=a.state},h={_root:null,_queue:null,_onerror:null,_oncancel:null,_limit_event:null};h.add=function(a,b){this._sanityCheck(),this._root._check_func(a),this._root._check_onerror(b);var c=this._queue;return null===c&&(c=[],this._queue=c),c.push([a,b]),this},h.parallel=function(a){var b=e(this._root,this);return this.add(function(a){b.executeParallel(a)},a),b},h.success=function(){this._sanityCheck(),null!==this._queue&&this.error(f.InternalError,"Invalid success() call"),this._root._handle_success(Array.prototype.slice.call(arguments))},h.successStep=function(){this._sanityCheck();var a=this._queue;null!==a?a.push([null,null]):this.success()},h.error=function(a,b){this._sanityCheck(),this._root.error(a,b)},h.setTimeout=function(a){this._sanityCheck(),null!==this._limit_event&&d.AsyncTool.cancelCall(this._limit_event);var b=this;return this._limit_event=d.AsyncTool.callLater(function(){b._limit_event=null;try{b._root.error(f.Timeout)}catch(a){}},a),this},h.setCancel=function(a){return this._oncancel=a,this},h.copyFrom=function(a){if(this._sanityCheck(),a._queue.length){var b=this._queue;null===b&&(b=[],this._queue=b),b.push.apply(b,a._queue)}var c=a.state,d=this.state;for(var e in c)"undefined"==typeof d[e]&&(d[e]=c[e]);return this},h.loop=function(a,b){return this._sanityCheck(),this.add(function(c){var e,g=new d.AsyncSteps,h=function(){e=new d.AsyncSteps(c.state),e.copyFrom(g),e.execute()};g.add(function(b){a(b)},function(a,e){var h;if(e===f.LoopCont){if(h=a.state._loop_term_label,!h||h===b)return void a.success();d.AsyncTool.callLater(function(){try{c["continue"](h)}catch(a){}})}else e===f.LoopBreak?(h=a.state._loop_term_label,d.AsyncTool.callLater(h&&h!==b?function(){try{c["break"](h)}catch(a){}}:function(){c.success()})):d.AsyncTool.callLater(function(){try{c.error(e)}catch(a){}});g.cancel()}).add(function(a){d.AsyncTool.callLater(h)}),c.setCancel(function(a){e.cancel(),g.cancel()}),h()}),this},h.repeat=function(a,b,c){var d=0;return this.loop(function(c){a>d?b(c,d++):c["break"]()},c),this},h.forEach=function(a,b,c){if(Array.isArray(a))this.repeat(a.length,function(c,d){b(c,d,a[d])},c);else{var d=Object.keys(a);this.repeat(d.length,function(c,e){b(c,d[e],a[d[e]])},c)}return this},h["break"]=function(a){this._sanityCheck(),this.state._loop_term_label=a,this._root.error(f.LoopBreak)},h["continue"]=function(a){this._sanityCheck(),this.state._loop_term_label=a,this._root.error(f.LoopCont)},h._cleanup=function(){this._root=null,this._queue=null,this._onerror=null,this._oncancel=null,this.state=null},h._sanityCheck=function(){if(null===this._root)throw Error(f.InternalError,"Unexpected call, object is out of service");var a=this._root._stack;a[a.length-1]!==this&&this._root.error(f.InternalError,"Invalid call (sanity check)")},g.prototype=h,c.AsyncStepProtector=g},function(b,c){"use strict";function d(a){"undefined"==typeof a&&(a=function(){return this.state}),this.state=a,this._queue=[],this._stack=[],this._in_execute=!1;var b=this;this._execute_cb=function(){b.execute()}}var e=a(2),f=a(3),g=a(5);c=b.exports=function(){return new b.exports.AsyncSteps};var h=a(0),i=a(6);c.AsyncTool=e,c.FutoInError=g,c.installAsyncToolTest=function(a){c.AsyncTool=a===!1?e:f};var j={_execute_event:null,_next_args:[]};j._check_func=function(a){a.length<1&&this.error(g.InternalError,"Step function must expect at least AsyncStep interface")},j._check_onerror=function(a){a&&2!==a.length&&this.error(g.InternalError,"Error handler must take exactly two arguments")},j.add=function(a,b){return this._sanityCheck(),this._check_func(a),this._check_onerror(b),this._queue.push([a,b]),this},j.parallel=function(a){var b=i(this,this);return this.add(function(a){b.executeParallel(a)},a),b},j.error=function(a,b){throw this.state.error_info=b,this._in_execute||this._handle_error(a),new Error(a)},j.copyFrom=function(a){this._queue.push.apply(this._queue,a._queue);var b=a.state,c=this.state;for(var d in b)"undefined"==typeof c[d]&&(c[d]=b[d]);return this},j._handle_success=function(a){var b=this._stack;b.length||this.error(g.InternalError,"Invalid success completion"),this._next_args=a;for(var d=b[b.length-1];(d._limit_event&&(c.AsyncTool.cancelCall(d._limit_event),d._limit_event=null),d._cleanup(),b.pop(),b.length)&&(d=b[b.length-1],!d._queue.length););(b.length||this._queue.length)&&(this._execute_event=c.AsyncTool.callLater(this._execute_cb))},j._handle_error=function(a){this._next_args=[];for(var b,d,e=this._stack;e.length;e.pop()){if(b=e[e.length-1],b._limit_event&&(c.AsyncTool.cancelCall(b._limit_event),b._limit_event=null),b._oncancel&&(b._oncancel.call(null,b),b._oncancel=null),b._onerror){d=e.length,b._queue=null;try{this._in_execute=!0,b._onerror.call(null,b,a)}catch(f){this.state.last_exception=f,a=f.message}finally{this._in_execute=!1}if(d!==e.length)return}b._cleanup()}this._queue=[],this._execute_event&&(c.AsyncTool.cancelCall(this._execute_event),this._execute_event=null)},j.cancel=function(){this._next_args=[],this._execute_event&&(c.AsyncTool.cancelCall(this._execute_event),this._execute_event=null);for(var a,b=this._stack;b.length;)a=b.pop(),a._limit_event&&(c.AsyncTool.cancelCall(a._limit_event),a._limit_event=null),a._oncancel&&(a._oncancel.call(null,a),a._oncancel=null),a._cleanup();return this._queue=[],this},j.execute=function(){this._execute_event&&(c.AsyncTool.cancelCall(this._execute_event),this._execute_event=null);var a,b=this._stack;if(a=b.length?b[b.length-1]._queue:this._queue,a.length){var d=a.shift();if(null===d[0])return void this._handle_success([]);var e=h(this),f=this._next_args;this._next_args=[],f.unshift(e);try{e._onerror=d[1],b.push(e);var g=b.length;this._in_execute=!0,d[0].apply(null,f),g===b.length&&(null!==e._queue?this._execute_event=c.AsyncTool.callLater(this._execute_cb):null===e._limit_event&&null===e._oncancel&&this._handle_success([]))}catch(i){this._in_execute=!1,this.state.last_exception=i,this._handle_error(i.message)}finally{this._in_execute=!1}return this}},j._sanityCheck=function(){this._stack.length&&this.error(g.InternalError,"Top level add in execution")};var k=h.AsyncStepProtector.prototype;j.loop=k.loop,j.repeat=k.repeat,j.forEach=k.forEach,d.prototype=j,c.AsyncSteps=d},function(a,b){"use strict";b=a.exports={},"undefined"==typeof setImmediate?(b.callLater=function(a,b){return setTimeout(a,b)},b.cancelCall=function(a){return clearTimeout(a)}):(b.callLater=function(a,b){return b?setTimeout(a,b):setImmediate(a)},b.cancelCall=function(a){"undefined"!=typeof a._onImmediate?clearImmediate(a):clearTimeout(a)})},function(b,c){"use strict";var d=a(7),e=[];c=b.exports={},c.callLater=function(a,b){var c=1e3*d();b&&(c+=b);for(var f={f:a,t:c},g=0;g<e.length;++g)if(e[g].t>c)return void e.splice(g,0,f);return e.push(f),f},c.cancelCall=function(a){var b=e.indexOf(a);b>=0&&e.splice(b,1)},c.nextEvent=function(){var a=e.shift();a.f()},c.hasEvents=function(){return e.length>0},c.getEvents=function(){return e},c.resetEvents=function(){e.splice(0,e.length)},c.run=function(){for(;this.hasEvents();)this.nextEvent()}},function(b){!function(c){"use strict";var d=c.FutoIn||{};if("undefined"==typeof d.AsyncSteps){var e=a(1);c.$as=e,d.$as=e,c.FutoInError=e.FutoInError,d.AsyncSteps=e.AsyncSteps,c.FutoIn=d,b&&(b.exports=e)}}(window)},function(a,b){"use strict";b=a.exports={ConnectError:"ConnectError",CommError:"CommError",UnknownInterface:"UnknownInterface",NotSupportedVersion:"NotSupportedVersion",NotImplemented:"NotImplemented",Unauthorized:"Unauthorized",InternalError:"InternalError",InvokerError:"InvokerError",InvalidRequest:"InvalidRequest",DefenseRejected:"DefenseRejected",PleaseReauth:"PleaseReauth",SecurityError:"SecurityError",Timeout:"Timeout",LoopBreak:"LoopBreak",LoopCont:"LoopCont"}},function(b,c){"use strict";var d=a(1);c=b.exports=function(a,c){return new b.exports.ParallelStep(a,c)};var e=function(a,b){this._root=a,this._as=b,this._queue=[],this._psteps=[],this._complete_count=0},f={};f._root=null,f._as=null,f._psteps=null,f._complete_count=null,f._error=null,f.add=function(a,b){return this._root._check_func(a),this._root._check_onerror(b),this._queue.push([a,b]),this},f._complete=function(){this._complete_count+=1,this._complete_count===this._psteps.length&&(this._as.success(),this._cleanup())},f._error=function(a,b){try{this._as.error(a,b)}catch(c){}},f.executeParallel=function(a){var b;if(this._root!==a._root)return b=new e(a._root,a),b._queue.push.apply(b._queue,this._queue),void b.executeParallel(a);this._as=a;var c=this;if(!this._queue.length)return void this._complete();a.setCancel(function(){c.cancel()});var f=this._queue,g=this._psteps,h=function(a){c._complete()},i=function(a,b){c._error(b,a.state.error_info)},j=this._step_func_gen;f.forEach(function(b){var c=new d.AsyncSteps(a.state);c.add(j(b),i),c.add(h),g.push(c)}),g.forEach(function(a){a.execute()})},f._step_func_gen=function(a){return function(b){b.add(a[0],a[1])}},f.cancel=function(){this._psteps.forEach(function(a){a.cancel()}),this._cleanup()},f._cleanup=function(){this._root=null,this._as=null,this._psteps=null},e.prototype=f,c.ParallelStep=e},function(a){(function(){var b,c,d;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(a.exports=function(){return(b()-d)/1e6},c=process.hrtime,b=function(){var a;return a=c(),1e9*a[0]+a[1]},d=b()):Date.now?(a.exports=function(){return Date.now()-d},d=Date.now()):(a.exports=function(){return(new Date).getTime()-d},d=(new Date).getTime())}).call(this)}],a(4)});