!function(e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():this.$as=e()}(function(){function e(t){var n=e.cache[t];if(!n){var r={};n=e.cache[t]={id:t,exports:r},e.modules[t].call(r,n,r)}return n.exports}return e.cache=[],e.modules=[function(t,n){"use strict";var r=e(1),o=e(6),s=e(5);n=t.exports=function(e,n){return new t.exports.AsyncStepProtector(e,n)};var c=function(e){this._root=e,this.state=e.state},i={};c.prototype=i,i._root=null,i._queue=null,i._onerror=null,i._oncancel=null,i._limit_event=null,i.add=function(e,t){this._sanityCheck(),this._root._check_func(e),this._root._check_onerror(t);var n=this._queue;return null===n&&(n=[],this._queue=n),n.push([e,t]),this},i.parallel=function(e){var t=o(this._root,this);return this.add(function(e){t.executeParallel(e)},e),t},i.success=function(e){this._sanityCheck(),null!==this._queue&&this.error(s.InternalError,"Invalid success() call"),this._root._handle_success(Array.prototype.slice.call(arguments))},i.successStep=function(){this._sanityCheck();var e=this._queue;null!==e?e.push([null,null]):this.success()},i.error=function(e,t){this._sanityCheck(),this._root.error(e,t)},i.setTimeout=function(e){this._sanityCheck(),null!==this._limit_event&&r.AsyncTool.cancelCall(this._limit_event);var t=this;return this._limit_event=r.AsyncTool.callLater(function(){t._limit_event=null;try{t._root.error(s.Timeout)}catch(e){}},e),this},i.setCancel=function(e){return this._oncancel=e,this},i.copyFrom=function(e){if(this._sanityCheck(),e._queue.length){var t=this._queue;null===t&&(t=[],this._queue=t),t.push.apply(t,e._queue)}var n=e.state,r=this.state;for(var o in n)void 0===r[o]&&(r[o]=n[o]);return this},i.loop=function(e,t){return this._sanityCheck(),this.add(function(n){var o,c=new r.AsyncSteps,i=function(){(o=new r.AsyncSteps(n.state)).copyFrom(c),o.execute()};c.add(function(t){e(t)},function(e,o){var i;if(o===s.LoopCont){if(!(i=e.state._loop_term_label)||i===t)return void e.success();r.AsyncTool.callLater(function(){try{n.continue(i)}catch(e){}})}else o===s.LoopBreak?(i=e.state._loop_term_label)&&i!==t?r.AsyncTool.callLater(function(){try{n.break(i)}catch(e){}}):r.AsyncTool.callLater(function(){try{n.success()}catch(e){}}):r.AsyncTool.callLater(function(){try{n.error(o,n.state.error_info)}catch(e){}});c.cancel()}).add(function(e){r.AsyncTool.callLater(i)}),n.setCancel(function(e){o.cancel(),c.cancel()}),i()}),this},i.repeat=function(e,t,n){var r=0;return this.loop(function(n){r<e?t(n,r++):n.break()},n),this},i.forEach=function(e,t,n){if(Array.isArray(e))this.repeat(e.length,function(n,r){t(n,r,e[r])},n);else{var r=Object.keys(e);this.repeat(r.length,function(n,o){t(n,r[o],e[r[o]])},n)}return this},i.break=function(e){this._sanityCheck(),this.state._loop_term_label=e,this._root.error(s.LoopBreak)},i.continue=function(e){this._sanityCheck(),this.state._loop_term_label=e,this._root.error(s.LoopCont)},i._cleanup=function(){this._root=null,this._queue=null,this._onerror=null,this._oncancel=null,this.state=null},i._sanityCheck=function(){if(null===this._root)throw Error(s.InternalError,"Unexpected call, object is out of service");var e=this._root._stack;e[e.length-1]!==this&&this._root.error(s.InternalError,"Invalid call (sanity check)")},n.AsyncStepProtector=c},function(t,n){"use strict";function r(e){void 0===e&&(e=function(){return this.state}),this.state=e,this._queue=[],this._stack=[],this._in_execute=!1,this._next_args=[];var t=this;this._execute_cb=function(){t.execute()}}var o=e(2),s=e(3),c=e(5);n=t.exports=function(){return new t.exports.AsyncSteps};var i=e(0),l=e(6);n.AsyncTool=o,n.FutoInError=c,n.installAsyncToolTest=function(e){n.AsyncTool=!1===e?o:s};var u={};r.prototype=u,u._execute_event=null,u._next_args=null,u._check_func=function(e){e.length<1&&this.error(c.InternalError,"Step function must expect at least AsyncStep interface")},u._check_onerror=function(e){e&&2!==e.length&&this.error(c.InternalError,"Error handler must take exactly two arguments")},u.add=function(e,t){return this._sanityCheck(),this._check_func(e),this._check_onerror(t),this._queue.push([e,t]),this},u.parallel=function(e){var t=l(this,this);return this.add(function(e){t.executeParallel(e)},e),t},u.error=function(e,t){throw this.state.error_info=t,this._in_execute||this._handle_error(e),new Error(e)},u.copyFrom=function(e){this._queue.push.apply(this._queue,e._queue);var t=e.state,n=this.state;for(var r in t)void 0===n[r]&&(n[r]=t[r]);return this},u._handle_success=function(e){var t=this._stack;t.length||this.error(c.InternalError,"Invalid success completion"),this._next_args=e;for(var r=t[t.length-1];(r._limit_event&&(n.AsyncTool.cancelCall(r._limit_event),r._limit_event=null),r._cleanup(),t.pop(),t.length)&&!(r=t[t.length-1])._queue.length;);(t.length||this._queue.length)&&(this._execute_event=n.AsyncTool.callLater(this._execute_cb))},u._handle_error=function(e){this._next_args=[];for(var t,r,o=this._stack;o.length;o.pop()){if((t=o[o.length-1])._limit_event&&(n.AsyncTool.cancelCall(t._limit_event),t._limit_event=null),t._oncancel&&(t._oncancel.call(null,t),t._oncancel=null),t._onerror){r=o.length,t._queue=null;try{this._in_execute=!0,t._onerror.call(null,t,e)}catch(t){this.state.last_exception=t,e=t.message}finally{this._in_execute=!1}if(r!==o.length)return}t._cleanup()}this._queue=[],this._execute_event&&(n.AsyncTool.cancelCall(this._execute_event),this._execute_event=null)},u.cancel=function(){this._next_args=[],this._execute_event&&(n.AsyncTool.cancelCall(this._execute_event),this._execute_event=null);for(var e,t=this._stack;t.length;)(e=t.pop())._limit_event&&(n.AsyncTool.cancelCall(e._limit_event),e._limit_event=null),e._oncancel&&(e._oncancel.call(null,e),e._oncancel=null),e._cleanup();return this._queue=[],this},u.execute=function(){this._execute_event&&(n.AsyncTool.cancelCall(this._execute_event),this._execute_event=null);var e,t=this._stack;if((e=t.length?t[t.length-1]._queue:this._queue).length){var r=e.shift();if(null!==r[0]){var o=i(this),s=this._next_args;this._next_args=[],s.unshift(o);try{o._onerror=r[1],t.push(o);var c=t.length;this._in_execute=!0,r[0].apply(null,s),c===t.length&&(null!==o._queue?this._execute_event=n.AsyncTool.callLater(this._execute_cb):null===o._limit_event&&null===o._oncancel&&this._handle_success([]))}catch(e){this._in_execute=!1,this.state.last_exception=e,this._handle_error(e.message)}finally{this._in_execute=!1}return this}this._handle_success([])}},u._sanityCheck=function(){this._stack.length&&this.error(c.InternalError,"Top level add in execution")};var a=i.AsyncStepProtector.prototype;u.loop=a.loop,u.repeat=a.repeat,u.forEach=a.forEach,n.AsyncSteps=r},function(e,t){"use strict";t=e.exports={},"undefined"==typeof setImmediate?(t.callLater=function(e,t){return setTimeout(e,t)},t.cancelCall=function(e){return clearTimeout(e)}):(t.callLater=function(e,t){return t?setTimeout(e,t):setImmediate(e)},t.cancelCall=function(e){void 0!==e._onImmediate?clearImmediate(e):clearTimeout(e)})},function(t,n){"use strict";var r=e(7),o=[];(n=t.exports={}).callLater=function(e,t){var n=1e3*r();t&&(n+=t);for(var s={f:e,t:n},c=0;c<o.length;++c)if(o[c].t>n)return void o.splice(c,0,s);return o.push(s),s},n.cancelCall=function(e){var t=o.indexOf(e);t>=0&&o.splice(t,1)},n.nextEvent=function(){o.shift().f()},n.hasEvents=function(){return o.length>0},n.getEvents=function(){return o},n.resetEvents=function(){o.splice(0,o.length)},n.run=function(){for(;this.hasEvents();)this.nextEvent()}},function(t,n){!function(n){"use strict";var r=n.FutoIn||{};if(void 0===r.AsyncSteps){var o=e(1);n.$as=o,r.$as=o,n.FutoInError=o.FutoInError,r.AsyncSteps=o.AsyncSteps,n.FutoIn=r,t&&(t.exports=o)}}(window)},function(e,t){"use strict";e.exports={ConnectError:"ConnectError",CommError:"CommError",UnknownInterface:"UnknownInterface",NotSupportedVersion:"NotSupportedVersion",NotImplemented:"NotImplemented",Unauthorized:"Unauthorized",InternalError:"InternalError",InvokerError:"InvokerError",InvalidRequest:"InvalidRequest",DefenseRejected:"DefenseRejected",PleaseReauth:"PleaseReauth",SecurityError:"SecurityError",Timeout:"Timeout",LoopBreak:"LoopBreak",LoopCont:"LoopCont"}},function(t,n){"use strict";var r=e(1);n=t.exports=function(e,n){return new t.exports.ParallelStep(e,n)};var o=function(e,t){this._root=e,this._as=t,this._queue=[],this._psteps=[],this._complete_count=0},s={};o.prototype=s,s._root=null,s._as=null,s._psteps=null,s._complete_count=null,s._error=null,s.add=function(e,t){return this._root._check_func(e),this._root._check_onerror(t),this._queue.push([e,t]),this},s._complete=function(){this._complete_count+=1,this._complete_count===this._psteps.length&&(this._as.success(),this._cleanup())},s._error=function(e,t){try{this._as.error(e,t)}catch(e){}},s.executeParallel=function(e){var t;if(this._root!==e._root)return(t=new o(e._root,e))._queue.push.apply(t._queue,this._queue),void t.executeParallel(e);this._as=e;var n=this;if(this._queue.length){e.setCancel(function(){n.cancel()});var s=this._queue,c=this._psteps,i=function(e){n._complete()},l=function(e,t){n._error(t,e.state.error_info)},u=this._step_func_gen;s.forEach(function(t){var n=new r.AsyncSteps(e.state);n.add(u(t),l),n.add(i),c.push(n)}),c.forEach(function(e){e.execute()})}else this._complete()},s._step_func_gen=function(e){return function(t){t.add(e[0],e[1])}},s.cancel=function(){this._psteps.forEach(function(e){e.cancel()}),this._cleanup()},s._cleanup=function(){this._root=null,this._as=null,this._psteps=null},n.ParallelStep=o},function(e,t){(function(){var t,n,r,o,s,c;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-s)/1e6},n=process.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),c=1e9*process.uptime(),s=o-c):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}],e(4)});